---
name: code-reviewer
description:
    コードレビューを依頼された際に使用するスキルです。
    ローカルの変更とGitHubのPull Requestの両方をサポートします。
---

# Code Reviewer

プロジェクトの基準に準拠した専門的かつ徹底的なコードレビューをします。

## 進め方

### 1. レビュー対象の決定

- **PRの場合**: PR番号またはURLが指定された場合、PRの情報を取得し、変更の意図や背景を把握します。
    - **PR情報の取得**: `gh pr view <pr_number>`
    - **PRのチェックアウト**: `gh pr checkout <pr_number>`
- **ローカル変更の場合**: レビュー対象の指定がない場合、`git diff`（作業ツリー）および `git diff --staged`（ステージ済み）のコード差分を確認します。

### 2. 事前検証

1. **リント**: `uv run ruff check .`
2. **フォーマット**: `uv run ruff format --check .`
3. **テスト**: `uv run pytest`
4. **(Optional) ビルド**: `uv run pyinstaller -y --clean build.spec`

ビルドは時間がかかるため、実行するかユーザーに確認し、承認を得た場合にのみ実行します。

### 3. 詳細な分析

以下の観点で分析します。

- **規約準拠**: `AGENTS.md`の指針に従っているか？
- **正確性**: バグや論理的な誤りがないか？ 意図しない副作用はないか？ コードとコメントに矛盾はないか？
- **保守性**: 将来的に理解しやすく変更しやすいか？ 確立された設計パターンに準拠しているか？
- **安全性**: 脆弱性はないか？ セキュアコーディングしているか？
- **性能**: パフォーマンスの低下は生じないか？
- **エッジケースとエラー処理**: エッジケースと潜在的なエラーを適切に処理しているか？
- **テスト網羅性**: 適切なテストコードはあるか？

### 4. フィードバックの提示

- **概要**: 変更の概要と全体的な評価
- **指摘事項**: `致命的な点`、`改善点`、`些細な点`のレベルに分類して記述
- **結論**: マージ／コミットの可否、推奨や提案

## 原則

- **コンテキストの補完**: 詳細なレビューをユーザーに要求された場合、または、コード差分（diff）のみで変更の意図や背景を把握できない場合は、関連ファイルをすべて読み込み、全体の整合性を確認すること。
- **競合の回避**: 未コミットの変更がある状態で`gh pr checkout`を行う際は、ユーザーに`git stash`を促すこと。
